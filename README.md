# Order Service

## Содержание
* [Краткое описание](#краткое-описание)
* [Технологии](#технологии)
* [Структура проекта](#структура-проекта)
* [Установка и запуск](#установка-и-запуск)
* [Запуск тестов](#запуск-тестов)
* [Полезные команды](#полезные-команды)

---
## Краткое описание

Order Service — это высокопроизводительный микросервис для асинхронной обработки, хранения и предоставления информации о заказах. Сервис потребляет сообщения о заказах из **Apache Kafka**, выполняет их валидацию, сохраняет в **PostgreSQL** и предоставляет HTTP API для получения данных, используя **LRU-кэш** для снижения нагрузки на базу данных и ускорения ответа.

---
## Технологии

| Категория | Технология | Назначение |
| :--- | :--- | :--- |
| **Основной язык** | **Go** (Golang) | Основная разработка сервиса. |
| **База данных** | **PostgreSQL** | Хранение данных о заказах. |
| **Брокер сообщений** | **Apache Kafka** | Асинхронный прием данных о заказах. |
| **Развертывание** | **Docker** / **Docker Compose** | Упаковка и оркестрация компонентов. |
| **Миграции** | **Goose** | Управление схемой базы данных. |
| **Кэширование** | **LRU Cache** (golang-lru) | Внутрипроцессное кэширование часто запрашиваемых заказов. |
| **Валидация** | **go-playground/validator** | Валидация структур данных заказа. |

---
## Структура проекта

```
.order-service-wbtech
├── cmd/                          # Точки входа (Kafka producer, HTTP server)
│   ├── producer/
│   │   └── main.go
│   └── server/
│       └── main.go
├── frontend/
│   └── index.html
├── internal/
│   ├── api/                      # Реализация HTTP-обработчиков
│   │   └── handler.go
│   ├── cache/                    # Логика LRU-кэширования данных
│   │   ├── cache.go
│   │   └── cache_test.go
│   ├── config/                   # Обработка и загрузка конфигурации из .env
│   │   └── config.go
│   ├── kafka/                    # Реализация Kafka-консьюмера
│   │   └── consumer.go
│   ├── mocks/
│   │   ├── Cache.go
│   │   └── Storage.go
│   ├── model/                    # Структуры данных
│   │   └── model.go
│   ├── service/                  # Бизнес-логика проекта
│   │   ├── service.go
│   │   └── service_test.go
│   ├── storage/                  # Реализация работы с хранилищем данных
│   │   ├── postgres.go
│   │   └── postgres_test.go
│   └── validator/                # Функции для валидации входящих данных.
│       └── validator.go
├── migrations/                   # SQL-файлы миграций базы данных
│   └── 001_create_orders.sql
│
├── .env
├── docker-compose.yml
├── Dockerfile
├── Dockerfile-producer
├── go.mod
└── go.sum
```

---
## Установка и запуск

Для запуска проекта необходимы установленные **Docker** и **Docker Compose**.

1. **Клонирование репозитория:**

```bash
git clone https://github.com/akhmed9505/order-service.git
cd order-service
```

2. **Создайте .env файл**:

```bash
cp .env.example .env
```

Отредактировать `.env` при необходимости.

3. **Запуск всех компонентов через Docker Compose:**

```d
docker compose up --build -d
```

4. **Проверка работы:**

- Сервис будет доступен по адресу: `http://localhost:8080`
- API для получения заказа: `http://localhost:8080/order/<order_uid>`

---
## Запуск тестов

Тесты можно запускать локально при установленном Go.

**Запуск всех тестов:**

Локально в корне проекта через Go:

```go
go test ./...
```

---
## Полезные команды

| **Команда**                                                          | **Назначение**                                                     |
| -------------------------------------------------------------------- | ------------------------------------------------------------------ |
| `docker compose up --build -d`                                       | Сборка и запуск всех сервисов в фоновом режиме.                    |
| `docker compose down`                                                | Остановка и удаление всех запущенных контейнеров и сетей.          |
| `docker compose exec db psql -U order_service_user order_service_db` | Подключение к базе данных PostgreSQL для ручного просмотра данных. |
| `docker compose run --rm migrator down`                              | Откат последней миграции (Goose).                                  |

